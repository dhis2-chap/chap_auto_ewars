# chap_auto_ewars without yearly effect and with spatial smoothing
This version now supports adding geojson files and uses a bym2 model, which is a scaled and reparamterzied latent effect. It is replicated for each time step, which is either each week or each month (currently only one model). It combines an iid effect and an ICAR effect, and ends up with a precision parameter and a mixing parameter with a penalizing complexity prior. The precision parameter represents the overall precision for the two components while the mixing parameter represents the percentage of the variance explained by the spatial component, or ICAR. So a mixing of $0$ corresponds to only using an iid effect while a mixing of $1$ corresponds to only using an ICAR, and the rest mixes the two. The idea of the penalizing complexity (PC) prior is that the mixing parameter $\rho$ only grows larger if the data supports it, and it is generally quite conservative to limit unnessary model complexity. Note that this model uses a different docker image with some additional packages for handeling spatial data.

## Some ideas
* It could be worth experimenting with using the poisson likelihhod instead of the negative binomial, but it dident give me any noticably better results
* I also do not think the temporal RW1, as `f(month_num, model = "rw1", scale.model = T, replicate = ID_spat_num)`, workedwell. This is a RW1 in time for each region with a common precision parameter. It performed visualy worse than the original model, but probably wise to compare them with more sophisticated evaluation criteria when they are available in CHAP.
* Concerning the regions that border other countries, this should probably already be captured by the iid model in the bym2, if not, it is possible to include an additional iid model only for these regions based on some identifying column in the dataframe, say `ID_border` or something. For instance if `df$ID_border = 1, 2, 3, NA, 4, NA, NA` and we add `f(ID_border, model ="iid"` only the regions at place 1, 2, 3 and 5 will get an iid effect, could also possibly make a prior centered at smaller precision values if you think that is smart, but I generally think that adding this second iid model is a bit unneccesary. Another possibility is to include additional spatial smoothing accross the borders, which it probably challenging in terms of harminizing data.
* For the bym2, or having an iid and an ICAR, I tried both having a single model for all time points or and individual model for each timepoint. Overall, they produced predictions with an unreasonably large uncertainty.
* For now the model assumes that the correct names are in the column `VARNAME_1` in the geojson file. This works with the vietnamese polygons, but for polygons from Brazil it should instead be `id`. Need some way to supply this as an argument, for instance instead of the sixth argument `samples` that is no longer in use.

## Conclusion
It seems to me that exempting the yearly iid effect makes the models noticibly worse, and that a spatial smoothing is not enough to remedy this. The rw1 in time also proved insufficient in my testing, but there is probably some configuration where the yearly effect can be removed without great loss. I have only tested on monthly data, and it is possible the models work better with weekly intervals. Lastly, I was unable ot test with the Vietnam ISMIP dataset and only tested with a subset of the regions. This made the spatial smoothing a lot less inconsiquential. Thus, test datasets should include all regions available when assesing the spatial importance.
